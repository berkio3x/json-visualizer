<html>

<body>
    <div class="main">
        <textarea name="raw" id="source" placeholder="Paste your  json here "></textarea>
        <div id="parsed-tree"> </div>
    </div>

</body>

</html>


<script>
    //base case : value is string
    const braceTypes = {
        CURLY: 'curly',
        SQUARE: 'square'
    }


    function getBrace(braceType) {
        switch (braceType) {
            case braceTypes.CURLY:
                return {
                    open: '{',
                    close: '}'
                }
            case braceTypes.SQUARE:
                return {
                    open: '[',
                    close: ']'
                }
        }
    }

    function wrapBrace(dom, key, braceType) {
        var warpperDiv = document.createElement("div")
        var startBrace = document.createElement("span")
        var brace = getBrace(braceType)
        console.log('b', brace)

        if (typeof key != "undefined") {

            startBrace.innerText = `${key}: ${brace.open}`
        } else {
            startBrace.innerText = `${brace.open}`
        }

        startBrace.setAttribute("class", "start-brace")
        warpperDiv.appendChild(startBrace)
        warpperDiv.appendChild(dom)
        var endBrace = document.createElement("span")
        endBrace.innerText = `${brace.close}`
        endBrace.setAttribute("class", "end-brace")
        warpperDiv.appendChild(endBrace)
        startBrace.onmouseenter = function() {
            dom.style.borderLeft = "solid 1px gold"
        }
        startBrace.onmouseleave = function() {
            dom.style.borderLeft = "none"
        }

        return warpperDiv

    }

    //     {
    //   "type": "object",
    //   "properties": {
    //     "first_name": { "type": "string" },
    //     "last_name": { "type": "string" },
    //     "birthday": { "type": "string", "format": "date" },
    //     "address": {
    //       "type": "object",
    //       "properties": {
    //         "street_address": { "type": "string" },
    //         "city": { "type": "string" },
    //         "state": { "type": "string" },
    //         "country": { "type" : "string" }
    //       }
    //     }
    //   }
    // }

    // {"demo":{"os":{"windows":"not ok","mac":"good","linux":"best"}}}
    //     {
    //   "type": "object",
    //    "os":[{"windows":"ss"}],
    //   "properties": {
    //     "first_name":{"type":"string" }
    // }
    // } 


    function makeDom(data) {
        var domRoot = document.createElement("div")
        for (let [key, value] of Object.entries(data)) {

            if (Array.isArray(value)) {
                var arrayCOntainer = document.createElement("div")
                for (var i = 0; i < value.length; i++) {
                    if (value[i] instanceof Object) {
                        var div = makeDom(value[i])
                        div = wrapBrace(div, undefined, braceTypes.CURLY)
                        arrayCOntainer.appendChild(div)
                    } else {
                        console.log("else..")
                        var div = document.createElement("div")
                        div.innerText = `${value[i]} ,`
                        div.style.paddingLeft = 20
                        arrayCOntainer.appendChild(div)

                    }
                    console.log("domRoot", domRoot)
                }
                domRoot.appendChild(wrapBrace(arrayCOntainer, key, braceTypes.SQUARE))

            } else if (typeof value == "string" || typeof value == "number") {
                var div = document.createElement("div")
                div.innerText = `${key}: ${value}`
                domRoot.appendChild(div)
            } else {
                var div = makeDom(value)
                console.log(div)
                div.style.paddingLeft = 20
                domRoot.appendChild(wrapBrace(div, key, braceTypes.CURLY))
            }
        }

        return domRoot

    }


    function clearTree(root) {
        root.innerHTML = ""
    }
    var sourceInput = document.getElementById("source")

    sourceInput.addEventListener("input", (e) => {
        clearTree(document.getElementById("parsed-tree"))
        var data = sourceInput.value
        try {
            data = JSON.parse(data)
        } catch (erro) {
            console.log("error parsing..")
        }

        console.log(`data-: ${data}`)
        let domTree = makeDom(data)
        console.log(domTree)
        document.getElementById("parsed-tree").appendChild(wrapBrace(domTree, undefined, braceTypes.CURLY))
    })
</script>

<style>
    .main {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-gap: 10px;
    }
    
    #source {
        border: solid 1px black;
        height: 100vh;
        border-top: none;
    }
    
    textarea:focus {
        outline: none;
    }
    
    .start-brace,
    .end-brace {
        color: #2b901a;
    }
    
    #parsed-tree {
        font-family: monospace;
    }
    
     ::placeholder {
        font-size: 40px;
        font-weight: bold;
        font-family: sans-serif;
        color: #cecdcd;
    }
</style>